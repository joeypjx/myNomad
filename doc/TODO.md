# myNomad 后续改进计划 (TODO)

本文档参考 HashiCorp Nomad，列出了 myNomad 项目的后续改进方向和功能点，并按预估优先级排序。

## 优先级：高 (核心功能完善、稳定性和安全性)

1.  **[ ] 服务器高可用 (HA) 与 Leader 选举**
    *   **说明**: 目前的 `Leader` 类较为简单，无法应对服务器单点故障。需要实现基于 Raft 或类似一致性协议的 Leader 选举和日志复制，确保控制平面的高可用。
    *   **Nomad 参考**: Nomad Server 使用 Raft 实现高可用。

2.  **[ ] API 安全性 - 认证与授权 (ACL)**
    *   **说明**: 当前 API 接口缺乏认证和授权机制。需要引入 Token 认证、TLS 加密，并考虑实现基于角色的访问控制 (ACLs) 来限制不同用户/服务对 API 的操作权限。
    *   **Nomad 参考**: Nomad 提供了 ACL 系统来保护 API。

3.  **[ ] Agent 与 Server 之间通信加密 (mTLS)**
    *   **说明**: 确保 Agent 和 Server 之间的所有通信（注册、心跳、任务下发等）都通过 mTLS 进行加密，防止数据泄露和中间人攻击。
    *   **Nomad 参考**: Nomad 支持 mTLS 通信。

4.  **[ ] 完善的作业更新策略 (滚动更新、蓝绿部署)**
    *   **说明**: 当前作业更新是直接替换。需要实现更安全的更新策略，如滚动更新（逐步替换旧实例）、蓝绿部署，并支持健康检查和回滚机制。
    *   **Nomad 参考**: Job specification 中的 `update` 块。

5.  **[ ] 任务健康检查与服务发现集成**
    *   **说明**: Agent 需要能够对运行中的任务执行健康检查（HTTP, TCP, script），并将不健康的实例报告给 Server。集成简单的服务发现机制，或提供与 Consul 等工具集成的接口，使任务间可以互相发现。
    *   **Nomad 参考**: Task `service` 和 `check` 块。

6.  **[ ] 更精细的资源隔离和限制**
    *   **说明**: 目前资源定义较为简单。对于进程任务，需要利用 cgroups 等机制严格限制 CPU、内存、IO 等资源。对于容器，确保 Docker 的资源限制参数被正确应用和监控。目前可以设计为CPU核心数。
    *   **Nomad 参考**: Task `resources` 块。

7.  **[ ] 状态存储的可靠性与可扩展性**
    *   **说明**: SQLite 适用于开发和小型部署。生产环境需要更可靠的存储方案，如与 Consul/etcd 集成，或在实现 Raft 的基础上构建分布式存储层。

8.  **[ ] 调度策略增强 (原属于中优先级)**
    *   **说明**: 除了当前的隐式 `binpack`，实现更多调度策略，如 `spread`（尽可能分散），支持更复杂的约束和亲和性/反亲和性规则。
    *   **Nomad 参考**: `spread` 调度算法, `affinity`, `constraint`。

## 优先级：中 (功能增强和易用性)

1.  **[ ] 命令行客户端 (CLI)**
    *   **说明**: 开发一个功能完善的 CLI 工具，方便用户提交作业、查看状态、管理节点等，替代直接使用 curl。
    *   **Nomad 参考**: `nomad` CLI。

2.  **[ ] Web UI 界面**
    *   **说明**: 提供一个 Web UI，可视化展示集群状态、作业列表、节点信息、分配详情等，方便用户监控和管理。
    *   **Nomad 参考**: Nomad UI。

3.  **[ ] 任务日志收集与查看**
    *   **说明**: Agent 需要能够收集任务的 stdout/stderr 日志，并提供 API 或 CLI 命令供用户查看，或支持将日志转发到外部日志系统。
    *   **Nomad 参考**: `nomad alloc logs`。

4.  **[ ] 卷管理与持久化存储**
    *   **说明**: 支持为任务挂载持久化存储卷，确保有状态应用的数据在任务重启或迁移后不丢失。
    *   **Nomad 参考**: Job specification 中的 `volume` 和 `volume_mount`。

5.  **[ ] 秘密管理 (Secrets Management)**
    *   **说明**: 安全地向任务注入敏感数据，如 API密钥、密码等，避免硬编码在作业配置中。可以考虑集成 Vault 或提供简单的内置秘密存储。
    *   **Nomad 参考**: Task `template` 和 `vault` 块。

6.  **[ ] 调度策略增强**
    *   **说明**: 除了当前的隐式 `binpack`，实现更多调度策略，如 `spread`（尽可能分散），支持更复杂的约束和亲和性/反亲和性规则。
    *   **Nomad 参考**: `spread` 调度算法, `affinity`, `constraint`。

7.  **[ ] 作业类型扩展 (System, Batch, Periodic)**
    *   **说明**: 支持不同类型的作业：
        *   `System`: 在所有（或符合条件的）节点上运行一个实例。
        *   `Batch`: 一次性执行的批量处理作业。
        *   `Periodic`: 定时执行的作业 (类似 cron)。
    *   **Nomad 参考**: Job `type` (service, batch, system), `periodic` 块。

8.  **[ ] 更好的资源计量与监控指标暴露**
    *   **说明**: Agent 和 Server 暴露更详细的监控指标 (如 Prometheus 格式)，包括资源使用率、任务事件、API 请求统计等。

## 优先级：低 (高级功能和生态扩展)

1.  **[ ] 插件系统 (驱动、网络、存储)**
    *   **说明**: 设计插件化的架构，允许社区或用户扩展新的任务驱动 (如 QEMU, LXC)、网络模式、存储提供者等。
    *   **Nomad 参考**: Nomad 的插件架构。

2.  **[ ] 命名空间 (Namespaces) / 多租户**
    *   **说明**: 实现命名空间，用于在共享集群中隔离不同团队或应用的资源和作业。
    *   **Nomad 参考**: Nomad Namespaces。

3.  **[ ] 配额管理 (Resource Quotas)**
    *   **说明**: 在命名空间基础上，实现资源配额管理，限制每个租户可以使用的资源总量。
    *   **Nomad 参考**: Nomad Quotas。

4.  **[ ] 多区域联邦 (Federation)**
    *   **说明**: 支持将多个独立的 myNomad 集群连接起来，实现跨区域的作业部署和管理 (高级特性)。
    *   **Nomad 参考**: Nomad Federation。

5.  **[ ] 作业模板化与变量**
    *   **说明**: 支持在作业文件中使用模板和变量，允许在运行时动态配置任务。
    *   **Nomad 参考**: Task `template` 块。

6.  **[ ] 垃圾回收机制**
    *   **说明**: 实现更完善的垃圾回收机制，自动清理已停止/失败的分配、旧的作业版本等，防止数据库膨胀。

## 未来探索

*   **[ ] Serverless/函数计算集成**
*   **[ ] GPU 资源支持**
*   **[ ] 与 CI/CD 系统集成**

---

这份 TODO 列表可以作为项目后续迭代的路线图。每个条目的具体实现细节和优先级可能会根据项目发展和社区反馈进行调整。 